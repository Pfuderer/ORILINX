Bootstrap: docker
From: nvidia/cuda:13.1.0-devel-ubuntu24.04

%labels
    Version v1.0.1

%help
    ORILINX is software that detects the location of replication origins in mammalian genomes. 
    Source: https://github.com/Pfuderer/ORILINX
    Documentation: https://orilinx.readthedocs.io/en/latest/?badge=latest
    Web: https://www.boemogroup.org/
    Please submit any bugs to https://github.com/Pfuderer/ORILINX/issues.

%post

    TZ=Europe/London
    ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
    apt update
    apt install -y tzdata

    # Install system packages
    apt-get update && apt-get install -y \
        build-essential \
        wget \
        git \
        python3 \
        python3-pip \
        python3-venv

    # Create virtual environment
    python3 -m venv /opt/orilinx-venv
    . /opt/orilinx-venv/bin/activate

    # Clone and install ORILINX
    mkdir -p /app
    cd /app
    git clone --recursive https://github.com/Pfuderer/ORILINX.git
    cd ORILINX
    pip install --upgrade pip
    pip install -e .
    orilinx fetch_models
    
%environment

    # Activate virtual environment
    export PATH=/opt/orilinx-venv/bin:$PATH
    export VIRTUAL_ENV=/opt/orilinx-venv

    # cuda paths
    export CUDA_HOME=/usr/local/cuda
    export CPATH=/usr/local/cuda/include:$CPATH
    export CUDA_PATH=/usr/local/cuda
    export LIBRARY_PATH=/usr/local/cuda/lib64:$LIBRARY_PATH
    export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH
    export PATH=/usr/local/cuda/bin:$PATH

%runscript
    exec orilinx "$@"